## AsIs

**Текущая функциональность приложения:**

- Получение конфигурации системы отопления
- Обновление конфигурации системы отопления
- Включение/Отключение системы отопления
- Автоматическое поддержание температуры(Не реализованно)
- Получение текущей температуры

**Основные домены монолитного приложения:**

- Управление устройством
- Сбор метрик
- Регистрация заявок на подключение системы(нет описания в задании как происходит вызов мастера для подключения)

------------

## ToBe

# Описание системы

## Компоненты системы

### API Gateway

Центральная точка входа для всех запросов от внешних систем (пользователей и устройств). Обрабатывает запросы и
направляет их соответствующим сервисам.

### Sensor API Layer

Принимает данные от датчиков и записывает их в Kafka.

### Device Service

Управляет устройствами в системе. Обрабатывает запросы на конфигурацию и управление устройствами. Хранит данные о
устройствах в базе данных.

### Telemetry Service

Обрабатывает и сохраняет телеметрические данные, поступающие от устройств. Использует базу данных InfluxDB для хранения
телеметрических данных.

### User Service

Управляет данными пользователей и их учетными записями. Хранит данные о пользователях в базе данных PostgreSQL.

### House Service

Управляет данными о домах и связанных с ними устройствах. Хранит данные о домах в базе данных PostgreSQL.

### Kafka

Обрабатывает сообщения и управляет топиками. Используется для обмена сообщениями между сервисами и устройствами.
Включает в себя брокер Kafka и ZooKeeper для координации кластера.

## Взаимодействие между компонентами

- **Пользователь** взаимодействует с **API Gateway** для управления домом и устройствами, а также для просмотра данных
  телеметрии.
- **API Gateway** направляет запросы к **User Service** для верификации пользователя и получения данных.
- **API Gateway** направляет запросы к **House Service** для получения данных о домах и связанных с ними устройствах.
- **API Gateway** направляет запросы к **Device Service** для управления устройствами и их конфигурацией.
- **Sensor API Layer** Датчики отправляют данные через Sensor API Layer, который записывает их в Kafka.
- **Device Service** обрабатывает данные телеметрии и передает их в **Telemetry Service** для сохранения и анализа.
- **Sensor** отправляет данные телеметрии в **Device Service** и запросы конфигурации в **API Gateway**.
- **Sensor** запрашивает команды через **API Gateway** в **Device Service**.

## Поток данных

1. **Датчики** отправляют данные телеметрии в **Sensor API Layer**, который проводит валидацию и пишет данные в **Kafka**.
2. **Пользователь** отправляет запросы на управление устройствами через **API Gateway**, который направляет запросы в *
   *Device Service**.
3. **Device Service**  взаимодействует с **Kafka** получая события, применяет бизнес логику и отправляет на хранение и анализ в **Telemetry Service**.
4. **Device Service** обрабатывает запросы и обновляет конфигурации устройств, а также взаимодействует с **Kafka** для
   обмена сообщениями.
5. **Kafka** управляет топиками и передает сообщения о событиях между **Device Service** и другими компонентами системы.
